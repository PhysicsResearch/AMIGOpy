# .gitlab-ci.yml

stages:
  - build

variables:
  # Name of the conda environment (must match amigo.yml)
  CONDA_ENV: amigo
  # Path to your environment specification
  ENV_YML: amigo.yml

build_and_package:
  stage: build
  tags:
    - shell       # your Windows runner tag
  before_script:
    # 1) Ensure conda itself is up-to-date
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" update -n base -c defaults conda --yes'
    # 2) Create the "amigo" environment from amigo.yml
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" env create -f $ENV_YML -n $CONDA_ENV --quiet'
  script:
    # 3) Build your EXE with PyInstaller inside the conda env
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" run -n $CONDA_ENV pyinstaller Launch_ImGUI.spec'
    # 4) Package into a single installer with Inno Setup
    - |
      & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" "compile.iss"
  artifacts:
    paths:
      - Output/mysetup.exe   # match the filename you defined in compile.iss
    expire_in: 1 week