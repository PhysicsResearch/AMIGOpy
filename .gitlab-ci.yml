stages:
  - build
  - package

variables:
  # the actual name of your env, per amigo.yml
  CONDA_ENV: amigo
  ENV_YML: amigo.yml

build:
  stage: build
  tags:
    - shell
  before_script:
    # make sure conda is up-to-date, then create your env
    - conda update -n base -c defaults conda --yes
    - conda env create -f $ENV_YML -n $CONDA_ENV --quiet
  script:
    # run pyinstaller inside the "amigo" env
    - conda run -n $CONDA_ENV pyinstaller Launch_ImGUI.spec
  artifacts:
    paths:
      - dist/

package:
  stage: package
  tags:
    - shell
  dependencies:
    - build
  script:
    # Inno Setup doesn’t need the Python env—just compile.
    - '"C:\Program Files (x86)\Inno Setup 6\ISCC.exe" compile.iss'
  artifacts:
    paths:
      - Output/my_setup.exe