stages:
  - build
  - package

variables:
  CONDA_ENV: amigo_env
  ENV_YML: amigo.yml

build:
  stage: build
  tags:
    - shell
  before_script:
    # update conda
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" update -n base -c defaults conda --yes'
    # create & activate env
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" env create -f $ENV_YML -n $CONDA_ENV --quiet'
    # Activate (use the batch file if needed)
    - 'C:\ProgramData\Anaconda3\Scripts\activate.bat $CONDA_ENV'
  script:
    - pyinstaller Launch_ImGUI.spec
  artifacts:
    paths:
      - dist/

package:
  stage: package
  tags:
    - shell
  dependencies:
    - build
  before_script:
    - 'C:\ProgramData\Anaconda3\Scripts\activate.bat $CONDA_ENV'
  script:
    - '"C:\Program Files (x86)\Inno Setup 6\ISCC.exe" compile.iss'
  artifacts:
    paths:
      - Output/my_setup.exe