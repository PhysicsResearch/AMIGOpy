stages:
  - build
  - package

variables:
  CONDA_ENV: amigo
  ENV_YML: amigo.yml

build:
  stage: build
  tags:
    - shell
  before_script:
    # 1) Update conda itself
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" update -n base -c defaults conda --yes'
    # 2) Create your env from amigo.yml
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" env create -f $ENV_YML -n $CONDA_ENV --quiet'
  script:
    # 3) Run PyInstaller inside the "amigo" env
    - '& "C:\ProgramData\Anaconda3\Scripts\conda.exe" run -n $CONDA_ENV pyinstaller Launch_ImGUI.spec'
  artifacts:
    paths:
      - dist/

package:
  stage: package
  tags:
    - shell
  dependencies:
    - build
  script:
    # Inno Setup doesn’t need the Python env—just compile.
    - '"C:\Program Files (x86)\Inno Setup 6\ISCC.exe" compile.iss'
  artifacts:
    paths:
      - Output/my_setup.exe
